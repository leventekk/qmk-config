#include "keycodes.h"
#include "macros.c"
#include "oled.c"
#include "g/keymap_combo.h"

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [BASE] = LAYOUT_split_3x6_3(
        // ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮   ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮
        // │   TAB   │    Q    │    W    │    E    │    R    │    T    │   │    Y    │    U    │    I    │    O    │    P    │  BSPC   │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           KC_TAB,    KC_Q,     KC_W,     KC_E,     KC_R,     KC_T,         KC_Y,     KC_U,     KC_I,     KC_O,     KC_P,     KC_BSPC,
        // │  LCTRL  │    A    │    S    │    D    │    F    │    G    │   │    H    │    J    │    K    │    L    │    ;    │   ESC   │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           KC_LCTL,   HOME_A,   HOME_S,   HOME_D,   HOME_F,   KC_G,         KC_H,     HOME_J,   HOME_K,   HOME_L,   HOME_SCLN, KC_ESC,
        // │  LSHFT  │    Z    │    X    │    C    │    V    │    B    │   │    N    │    M    │    ,    │    .    │    /    │  RSHFT  │
        // ╰─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┴─────────┴─────────╯
           KC_LSFT,   KC_Z,     KC_X,     KC_C,     KC_V,     KC_B,         KC_N,     KC_M,     KC_COMM,  KC_DOT,   KC_SLSH,  KC_RSFT,
        //                               │  LGUI   │ RAISE   │  SPACE  │   │  ENTER  │  LOWER  │  RALT   │
        //                               ╰─────────┴─────────┴─────────╯   ╰─────────┴─────────┴─────────╯
                                         KC_LGUI,  MO(RAISE), KC_SPC,        KC_ENT,   MO(LOWER), KC_RALT),
    [RAISE] = LAYOUT_split_3x6_3(
        // ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮   ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮
        // │         │    1    │    2    │    3    │    4    │    5    │   │    6    │    7    │    8    │    9    │    0    │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           ___,       KC_1,     KC_2,     KC_3,     KC_4,     KC_5,         KC_6,     KC_7,     KC_8,     KC_9,     KC_0,     ___,
        // │         │   DEL   │  CAPS   │         │         │         │   │  LEFT   │  DOWN   │   UP    │  RIGHT  │         │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           ___,       KC_DEL,   KC_CAPS,  _x_,      _x_,      _x_,          KC_LEFT,  KC_DOWN,  KC_UP,    KC_RIGHT, ___,      ___,
        // │         │         │         │         │         │         │   │  HOME   │ PG UP   │ PG DN   │   END   │         │         │
        // ╰─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┴─────────┴─────────╯
           ___,       _x_,      _x_,      _x_,      _x_,      _x_,          KC_HOME,  KC_PGUP,  KC_PGDN,  KC_END,   _x_,      ___,
        //                               │         │         │         │   │         │ ADJUST  │         │
        //                               ╰─────────┴─────────┴─────────╯   ╰─────────┴─────────┴─────────╯
                                         ___,      _x_,       ___,           ___,      MO(ADJUST), ___),

    [LOWER] = LAYOUT_split_3x6_3(
        // ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮   ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮
        // │         │    !    │    @    │    #    │    $    │    %    │   │    ^    │    &    │    *    │    `    │    ~    │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           ___,       KC_EXLM,  KC_AT,    KC_HASH,  KC_DLR,   KC_PERC,      KC_CIRC,  KC_AMPR,  KC_ASTR,  KC_GRAVE, KC_TILD,  ___,
        // │         │    "    │    [    │    {    │    (    │         │   │    /    │    -    │    =    │    :    │    ;    │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           ___,       KC_DQT,   KC_LBRC,  KC_LCBR,  KC_LPRN,  _x_,          KC_SLSH,  KC_MINUS, KC_EQL,   KC_COLON, KC_SCLN,  _x_,
        // │         │    '    │    ]    │    }    │    )    │         │   │    \    │    _    │    +    │    |    │    ?    │         │
        // ╰─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┴─────────┴─────────╯
           ___,       KC_QUOT,  KC_RBRC,  KC_RCBR,  KC_RPRN,  _x_,          KC_BSLS,  KC_UNDS,  KC_PLUS,  KC_PIPE,  KC_QUES,  _x_,
        //                               │         │ ADJUST  │         │   │         │         │         │
        //                               ╰─────────┴─────────┴─────────╯   ╰─────────┴─────────┴─────────╯
                                         ___,      MO(ADJUST), ___,          ___,      _x_,      ___),

    [ADJUST] = LAYOUT_split_3x6_3(
        // ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮   ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮
        // │ BOOTLDR │         │         │         │         │         │   │         │         │         │ PREV    │ NEXT    │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           QK_BOOT,   _x_,      _x_,      _x_,      _x_,      _x_,          _x_,      _x_,      _x_,      KC_MPRV,  KC_MNXT,  _x_,
        // │         │         │         │         │ NUM LYR │ PREV    │   │ NEXT    │         │         │ VOL DN  │ VOL UP  │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           _x_,       _x_,  _x_,      _x_,    TG(NUMERIC), PREV_DESKTOP, NEXT_DESKTOP, _x_, _x_,      KC_VOLD,  KC_VOLU,  _x_,
        // │         │         │         │         │         │ SCREEN  │   │         │         │         │ MUTE    │ PLAY    │         │
        // ╰─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┴─────────┴─────────╯
           _x_,       _x_,  _x_,      _x_,      _x_,    SCREENSHOT,      _x_,      _x_,      _x_,      KC_MUTE,  KC_MPLY,  _x_,
        //                               │         │         │         │   │         │         │         │
        //                               ╰─────────┴─────────┴─────────╯   ╰─────────┴─────────┴─────────╯
                                         ___,      ___,       ___,           ___,      ___,      ___),
    [NUMERIC] = LAYOUT_split_3x6_3(
        // ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮   ╭─────────┬─────────┬─────────┬─────────┬─────────┬─────────╮
        // │         │    1    │    2    │    3    │    4    │    5    │   │    6    │    7    │    8    │    9    │    0    │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           ___,       KC_1,     KC_2,     KC_3,     KC_4,     KC_5,         KC_6,     KC_7,     KC_8,     KC_9,     KC_0,     ___,
        // │         │         │         │         │ NUM LYR │         │   │         │         │         │         │         │         │
        // ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
           _x_,       _x_,      _x_,      _x_,    TG(NUMERIC), _x_,         _x_,      _x_,      _x_,      _x_,      ___,      _x_,
        // │         │         │         │         │         │         │   │         │         │         │         │         │         │
        // ╰─────────┴─────────┴─────────┼─────────┼─────────┼─────────┤   ├─────────┼─────────┼─────────┼─────────┴─────────┴─────────╯
           _x_,       _x_,      _x_,      _x_,      _x_,      _x_,         _x_,      _x_,      ___,      ___,      ___,      _x_,
        //                               │         │         │         │   │         │         │         │
        //                               ╰─────────┴─────────┴─────────╯   ╰─────────┴─────────┴─────────╯
                                         ___,      ___,       ___,          ___,      ___,      ___),
};

// clang-format on

uint16_t get_combo_term(uint16_t index, combo_t *combo) {
    switch (index) {
        // Home-row and other tight combos
		case dquot_comb:
		case quot_comb:
            return COMBO_TERM;
        // Regular combos, slightly relaxed
        default:
            return COMBO_TERM + 25;
    }
}

bool get_combo_must_tap(uint16_t index, combo_t *combo) {
    switch (index) {
		case esc_comb:
		case del_comb:
		case bsp_comb:
		case capsword_comb:
		case dquot_comb:
		case quot_comb:
			return false;

		default:
			return true;
	}
}

bool combo_should_trigger(uint16_t combo_index, combo_t *combo) {
    // FIXME this doesn't seem to work?
    return true;
}
